import React, { useState, useEffect, useRef, useCallback } from 'react';
import { 
  Gamepad2, 
  Search, 
  Trophy, 
  Zap, 
  Flame, 
  LayoutGrid, 
  X, 
  Play, 
  Pause, 
  RotateCcw, 
  ChevronRight, 
  Star, 
  Heart,
  Crosshair,
  Skull,
  Shield,
  Target,
  Map,
  AlertTriangle,
  MessageSquare,
  Sparkles,
  Send,
  Bot,
  Crown,
  Lock,
  CheckCircle,
  CreditCard,
  Loader2,
  Smartphone,
  QrCode,
  ArrowRight,
  Timer
} from 'lucide-react';

const apiKey = "";

// --- GEMINI API HELPER ---
const callGemini = async (prompt, systemInstruction = "") => {
  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }],
          systemInstruction: { parts: [{ text: systemInstruction }] },
        }),
      }
    );

    if (!response.ok) {
      throw new Error(`API call failed: ${response.status}`);
    }

    const data = await response.json();
    return data.candidates?.[0]?.content?.parts?.[0]?.text || "Connection interrupted. Try again.";
  } catch (error) {
    console.error("Gemini API Error:", error);
    return "System offline. Unable to reach the Nexus AI core.";
  }
};

// --- ASSETS & STYLES ---
// Using Tailwind classes for styling.
// Custom hook for game loop handling
const useGameLoop = (callback, isRunning) => {
  const requestRef = useRef();
  const previousTimeRef = useRef();

  const animate = time => {
    if (previousTimeRef.current !== undefined) {
      const deltaTime = time - previousTimeRef.current;
      callback(deltaTime);
    }
    previousTimeRef.current = time;
    if (isRunning) {
      requestRef.current = requestAnimationFrame(animate);
    }
  };

  useEffect(() => {
    if (isRunning) {
      requestRef.current = requestAnimationFrame(animate);
    } else {
      cancelAnimationFrame(requestRef.current);
      previousTimeRef.current = undefined;
    }
    return () => cancelAnimationFrame(requestRef.current);
  }, [isRunning, callback]);
};

// --- UPI PAYMENT GATEWAY COMPONENT ---
const UPIPaymentGateway = ({ amount, onSuccess, onCancel }) => {
    const [method, setMethod] = useState('qr'); // 'qr' or 'vpa'
    const [vpa, setVpa] = useState('');
    const [paymentStatus, setPaymentStatus] = useState('idle'); // idle, processing, success
    const [timeLeft, setTimeLeft] = useState(300); // 5 minutes timer

    // Real UPI Intent Link (Note: using a placeholder merchant VPA)
    // In a real app, this would be your business VPA.
    const upiLink = `upi://pay?pa=6372971148@slc&pn=NEXUS%20GAMING&am=${amount}&cu=INR&tn=Pro%20Subscription`;
    const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiLink)}`;

    useEffect(() => {
        if (paymentStatus === 'processing' && timeLeft > 0) {
            const timer = setInterval(() => setTimeLeft(t => t - 1), 1000);
            return () => clearInterval(timer);
        }
    }, [paymentStatus, timeLeft]);

    const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    };

    const handleVerifyAndPay = () => {
        if (!vpa.includes('@')) {
            alert("Please enter a valid UPI ID (e.g., user@okaxis)");
            return;
        }
        setPaymentStatus('processing');
        
        // Simulate Payment Processing Time
        setTimeout(() => {
            setPaymentStatus('success');
            setTimeout(onSuccess, 1500);
        }, 4000);
    };

    const handleSimulateScan = () => {
        setPaymentStatus('processing');
        // Simulate user scanning and paying on their phone
        setTimeout(() => {
            setPaymentStatus('success');
            setTimeout(onSuccess, 1500);
        }, 4000);
    }

    if (paymentStatus === 'success') {
        return (
            <div className="flex flex-col items-center justify-center h-full py-10 animate-in zoom-in duration-300">
                <div className="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mb-4 shadow-lg shadow-green-500/50">
                    <CheckCircle size={40} className="text-white" />
                </div>
                <h3 className="text-2xl font-bold text-white mb-2">Payment Successful!</h3>
                <p className="text-gray-400">Welcome to Nexus Pro.</p>
            </div>
        );
    }

    if (paymentStatus === 'processing') {
        return (
            <div className="flex flex-col items-center justify-center h-full py-8 text-center">
                <div className="relative mb-6">
                    <div className="w-24 h-24 rounded-full border-4 border-purple-500/30 border-t-purple-500 animate-spin"></div>
                    <div className="absolute inset-0 flex items-center justify-center">
                        <Smartphone size={32} className="text-purple-400 animate-pulse" />
                    </div>
                </div>
                <h3 className="text-xl font-bold text-white mb-2">Check your Phone</h3>
                <p className="text-gray-400 text-sm mb-6 max-w-xs">
                    {method === 'vpa' ? `Open your UPI app and approve the request sent to ${vpa}` : "Complete the payment in your UPI app."}
                </p>
                <div className="flex items-center space-x-2 text-yellow-500 bg-yellow-500/10 px-4 py-2 rounded-full font-mono text-sm">
                    <Timer size={16} />
                    <span>Expires in {formatTime(timeLeft)}</span>
                </div>
                <button onClick={() => setPaymentStatus('idle')} className="mt-8 text-gray-500 hover:text-white text-sm">
                    Cancel Transaction
                </button>
            </div>
        );
    }

    return (
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
            {/* Tabs */}
            <div className="flex space-x-2 mb-6 bg-gray-900 p-1 rounded-lg">
                <button 
                    onClick={() => setMethod('qr')}
                    className={`flex-1 flex items-center justify-center py-2 rounded-md text-sm font-medium transition-all ${method === 'qr' ? 'bg-gray-700 text-white shadow-sm' : 'text-gray-400 hover:text-white'}`}
                >
                    <QrCode size={16} className="mr-2" /> Scan QR
                </button>
                <button 
                    onClick={() => setMethod('vpa')}
                    className={`flex-1 flex items-center justify-center py-2 rounded-md text-sm font-medium transition-all ${method === 'vpa' ? 'bg-gray-700 text-white shadow-sm' : 'text-gray-400 hover:text-white'}`}
                >
                    <Smartphone size={16} className="mr-2" /> Enter UPI ID
                </button>
            </div>

            {/* QR Method */}
            {method === 'qr' && (
                <div className="flex flex-col items-center animate-in fade-in slide-in-from-bottom-2">
                    <div className="bg-white p-2 rounded-lg mb-4 shadow-lg relative group cursor-pointer" onClick={handleSimulateScan}>
                        <img src={qrCodeUrl} alt="UPI QR Code" className="w-48 h-48" />
                        {/* Overlay for simulation hint */}
                        <div className="absolute inset-0 bg-black/80 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-xs text-center p-2 rounded-lg">
                            (Simulation)<br/>Click to simulate scan completion
                        </div>
                    </div>
                    <p className="text-gray-400 text-xs mb-4">Scan with any UPI App (GPay, PhonePe, Paytm)</p>
                    <div className="flex space-x-3 opacity-50 grayscale hover:grayscale-0 transition-all">
                         {/* Simple Icons representing generic UPI apps */}
                         <div className="w-8 h-8 bg-blue-600 rounded-full"></div>
                         <div className="w-8 h-8 bg-purple-600 rounded-full"></div>
                         <div className="w-8 h-8 bg-indigo-900 rounded-full"></div>
                    </div>
                </div>
            )}

            {/* VPA Method */}
            {method === 'vpa' && (
                <div className="space-y-4 animate-in fade-in slide-in-from-bottom-2 py-4">
                    <div>
                        <label className="block text-xs font-medium text-gray-400 mb-1">UPI ID / VPA</label>
                        <input 
                            type="text" 
                            value={vpa}
                            onChange={(e) => setVpa(e.target.value)}
                            placeholder="username@okaxis"
                            className="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-all"
                        />
                    </div>
                    <button 
                        onClick={handleVerifyAndPay}
                        className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg flex items-center justify-center transition-colors shadow-lg shadow-green-600/20"
                    >
                        Verify & Pay ₹{amount} <ArrowRight size={18} className="ml-2" />
                    </button>
                    <p className="text-center text-[10px] text-gray-500">
                        Secure payments by NPCI.
                    </p>
                </div>
            )}
        </div>
    );
};

// --- SUBSCRIPTION MODAL ---
const SubscriptionModal = ({ isOpen, onClose, onUpgrade }) => {
    const [step, setStep] = useState('plan'); // plan, payment

    if (!isOpen) return null;

    return (
        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/90 backdrop-blur-md animate-in fade-in duration-200">
            <div className="bg-gray-900 border border-gray-700 w-full max-w-3xl rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[500px]">
                
                {/* Left Side - Visual */}
                <div className="md:w-1/3 bg-gradient-to-br from-purple-900 to-indigo-900 p-8 flex flex-col justify-between relative overflow-hidden">
                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
                    <div className="relative z-10">
                        <Crown size={48} className="text-yellow-400 mb-4" />
                        <h2 className="text-3xl font-black text-white leading-tight">LEVEL UP<br/>YOUR GAME</h2>
                        <p className="text-indigo-200 mt-4 text-sm">Join the elite ranks of Nexus Pro members and dominate the leaderboards.</p>
                    </div>
                    <div className="relative z-10 mt-8">
                        <div className="flex items-center space-x-2 text-white/80 text-sm">
                            <Star size={16} className="fill-yellow-400 text-yellow-400" />
                            <span>Premium Badge</span>
                        </div>
                    </div>
                </div>

                {/* Right Side - Plans/Payment */}
                <div className="md:w-2/3 p-8 bg-gray-900 relative">
                    <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-white z-20"><X /></button>

                    {step === 'plan' ? (
                        <div className="animate-in fade-in slide-in-from-right-4 duration-300">
                            <h3 className="text-xl font-bold text-white mb-8">Select Your Plan</h3>

                            <div className="space-y-4">
                                {/* Free Plan */}
                                <div className="p-4 rounded-xl border border-gray-700 bg-gray-800/50 opacity-70 grayscale">
                                    <div className="flex justify-between items-center">
                                        <div>
                                            <h4 className="font-bold text-white">Rookie (Free)</h4>
                                            <p className="text-xs text-gray-400">Basic access</p>
                                        </div>
                                        <span className="text-gray-400 font-mono">₹0</span>
                                    </div>
                                </div>

                                {/* Pro Plan */}
                                <div className="p-1 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 relative shadow-xl shadow-purple-900/20">
                                    <div className="absolute -top-3 right-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full uppercase tracking-wider">
                                        Most Popular
                                    </div>
                                    <div className="p-5 rounded-[10px] bg-gray-800 h-full">
                                        <div className="flex justify-between items-center mb-4">
                                            <div>
                                                <h4 className="font-bold text-white flex items-center">
                                                    Nexus Pro <Crown size={16} className="ml-2 text-yellow-400 fill-yellow-400" />
                                                </h4>
                                                <p className="text-xs text-gray-400">Unlock everything</p>
                                            </div>
                                            <div className="text-right">
                                                <span className="text-2xl font-bold text-white">₹1</span>
                                                <span className="text-xs text-gray-500">/year</span>
                                            </div>
                                        </div>
                                        <ul className="space-y-2 mb-6">
                                            <li className="flex items-center text-sm text-gray-300"><CheckCircle size={14} className="text-green-400 mr-2" /> Unlock Battle Royale Games</li>
                                            <li className="flex items-center text-sm text-gray-300"><CheckCircle size={14} className="text-green-400 mr-2" /> Unlimited AI Lore Generation</li>
                                            <li className="flex items-center text-sm text-gray-300"><CheckCircle size={14} className="text-green-400 mr-2" /> Golden Username Badge</li>
                                        </ul>
                                        <button 
                                            onClick={() => setStep('payment')}
                                            className="w-full py-3 bg-white hover:bg-gray-100 text-black font-bold rounded-lg transition-colors flex items-center justify-center shadow-lg"
                                        >
                                            Proceed to Payment
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="h-full flex flex-col animate-in fade-in slide-in-from-right-4 duration-300">
                            <button 
                                onClick={() => setStep('plan')} 
                                className="flex items-center text-gray-500 hover:text-white text-sm mb-4"
                            >
                                <ChevronRight className="rotate-180 mr-1" size={16} /> Back to Plans
                            </button>
                            
                            <h3 className="text-xl font-bold text-white mb-2">Pay with UPI</h3>
                            <div className="flex items-center justify-between text-sm text-gray-400 mb-6 border-b border-gray-800 pb-4">
                                <span>Nexus Pro (1 Year)</span>
                                <span className="text-white font-bold font-mono">₹1.00</span>
                            </div>

                            <div className="flex-1">
                                <UPIPaymentGateway 
                                    amount={1} 
                                    onSuccess={() => {
                                        onUpgrade();
                                        setTimeout(onClose, 1500);
                                    }}
                                    onCancel={() => setStep('plan')}
                                />
                            </div>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
};

// --- NEXUS AI CHAT COMPONENT ---
const NexusAIChat = ({ isPremium }) => {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    { role: 'system', text: isPremium ? "Greetings, Pro Member! Nexus AI at your command." : "Welcome! I am Nexus AI. Ask me for tips." }
  ]);
  const [input, setInput] = useState("");
  const [isTyping, setIsTyping] = useState(false);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(scrollToBottom, [messages]);

  const handleSend = async () => {
    if (!input.trim()) return;
    
    const userMsg = input;
    setInput("");
    setMessages(prev => [...prev, { role: 'user', text: userMsg }]);
    setIsTyping(true);

    const systemPrompt = `You are Nexus, a hardcore AI gaming assistant. The user is ${isPremium ? 'a PRO SUBSCRIBER (treat them with high respect)' : 'a standard user'}. Use gaming terms. Keep it short.`;
    
    const responseText = await callGemini(userMsg, systemPrompt);

    setIsTyping(false);
    setMessages(prev => [...prev, { role: 'system', text: responseText }]);
  };

  return (
    <div className="fixed bottom-6 right-6 z-50 flex flex-col items-end pointer-events-none">
      {isOpen && (
        <div className="bg-gray-900 border border-purple-500/50 w-80 h-96 rounded-2xl shadow-2xl flex flex-col overflow-hidden mb-4 pointer-events-auto animate-in slide-in-from-bottom-10 fade-in duration-300">
            {/* Header */}
            <div className="bg-gradient-to-r from-purple-900 to-gray-900 p-3 flex items-center justify-between border-b border-gray-700">
                <div className="flex items-center space-x-2">
                    <Bot className={isPremium ? "text-yellow-400" : "text-purple-400"} size={20} />
                    <span className="font-bold text-white text-sm">Nexus AI {isPremium && <span className="text-[10px] bg-yellow-500 text-black px-1 rounded ml-1">PRO</span>}</span>
                </div>
                <button onClick={() => setIsOpen(false)} className="text-gray-400 hover:text-white">
                    <X size={16} />
                </button>
            </div>
            
            {/* Messages */}
            <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-black/40">
                {messages.map((msg, idx) => (
                    <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                        <div className={`max-w-[85%] p-3 rounded-xl text-xs ${
                            msg.role === 'user' 
                            ? 'bg-purple-600 text-white rounded-tr-none' 
                            : 'bg-gray-800 text-gray-200 rounded-tl-none border border-gray-700'
                        }`}>
                            {msg.text}
                        </div>
                    </div>
                ))}
                {isTyping && (
                    <div className="flex justify-start">
                        <div className="bg-gray-800 text-purple-400 p-3 rounded-xl rounded-tl-none border border-gray-700 text-xs animate-pulse">
                            Nexus is thinking...
                        </div>
                    </div>
                )}
                <div ref={messagesEndRef} />
            </div>

            {/* Input */}
            <div className="p-3 bg-gray-900 border-t border-gray-800 flex space-x-2">
                <input 
                    type="text" 
                    value={input}
                    onChange={(e) => setInput(e.target.value)}
                    onKeyDown={(e) => e.key === 'Enter' && handleSend()}
                    placeholder="Ask for tips..."
                    className="flex-1 bg-gray-800 border border-gray-700 rounded-full px-4 py-2 text-xs text-white focus:outline-none focus:border-purple-500"
                />
                <button 
                    onClick={handleSend}
                    disabled={!input.trim() || isTyping}
                    className="bg-purple-600 hover:bg-purple-500 text-white p-2 rounded-full disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <Send size={14} />
                </button>
            </div>
        </div>
      )}

      <button 
        onClick={() => setIsOpen(!isOpen)}
        className={`${isPremium ? 'bg-gradient-to-r from-yellow-500 to-orange-500 shadow-yellow-500/20' : 'bg-purple-600 shadow-purple-600/40'} text-white p-4 rounded-full shadow-lg transform hover:scale-110 transition-all pointer-events-auto group border-2 border-white/10`}
      >
        {isOpen ? <X size={24} /> : <MessageSquare size={24} className="group-hover:animate-bounce" />}
      </button>
    </div>
  );
};

// --- GAME 1: NEON SNAKE ---
const SnakeGame = ({ onGameOver, onScoreUpdate }) => {
  const canvasRef = useRef(null);
  const [snake, setSnake] = useState([{ x: 10, y: 10 }]);
  const [food, setFood] = useState({ x: 15, y: 15 });
  const [direction, setDirection] = useState({ x: 1, y: 0 });
  const [gameOver, setGameOver] = useState(false);
  const [score, setScore] = useState(0);
  const gridSize = 20;
  const tileCount = 25; // 500px / 20px

  // Input handling
  useEffect(() => {
    const handleKeyDown = (e) => {
      switch(e.key) {
        case 'ArrowUp': if(direction.y === 0) setDirection({ x: 0, y: -1 }); break;
        case 'ArrowDown': if(direction.y === 0) setDirection({ x: 0, y: 1 }); break;
        case 'ArrowLeft': if(direction.x === 0) setDirection({ x: -1, y: 0 }); break;
        case 'ArrowRight': if(direction.x === 0) setDirection({ x: 1, y: 0 }); break;
      }
    };
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [direction]);

  // Touch controls for mobile
  const handleTouch = (dir) => {
    switch(dir) {
      case 'UP': if(direction.y === 0) setDirection({ x: 0, y: -1 }); break;
      case 'DOWN': if(direction.y === 0) setDirection({ x: 0, y: 1 }); break;
      case 'LEFT': if(direction.x === 0) setDirection({ x: -1, y: 0 }); break;
      case 'RIGHT': if(direction.x === 0) setDirection({ x: 1, y: 0 }); break;
    }
  }

  // Game Logic Loop
  useEffect(() => {
    if (gameOver) return;

    const moveSnake = () => {
      const head = snake[0];
      const newHead = { x: head.x + direction.x, y: head.y + direction.y };

      // Wall collision
      if (newHead.x < 0 || newHead.x >= tileCount || newHead.y < 0 || newHead.y >= tileCount) {
        setGameOver(true);
        onGameOver(score);
        return;
      }

      // Self collision
      if (snake.some(segment => segment.x === newHead.x && segment.y === newHead.y)) {
        setGameOver(true);
        onGameOver(score);
        return;
      }

      let newSnake = [newHead, ...snake];
      
      // Food collision
      if (newHead.x === food.x && newHead.y === food.y) {
        const newScore = score + 10;
        setScore(newScore);
        onScoreUpdate(newScore);
        setFood({
          x: Math.floor(Math.random() * tileCount),
          y: Math.floor(Math.random() * tileCount)
        });
      } else {
        newSnake.pop();
      }
      
      setSnake(newSnake);
    };

    const interval = setInterval(moveSnake, 100);
    return () => clearInterval(interval);
  }, [snake, direction, food, gameOver, score, onGameOver, onScoreUpdate]);

  // Render
  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    
    // Clear
    ctx.fillStyle = '#111827'; // Dark bg
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw Snake
    ctx.shadowBlur = 15;
    ctx.shadowColor = '#00ff88';
    ctx.fillStyle = '#00ff88';
    snake.forEach((segment, i) => {
        // Head is slightly different color
        if(i === 0) ctx.fillStyle = '#ccffcc';
        else ctx.fillStyle = '#00ff88';
        ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize - 2, gridSize - 2);
    });

    // Draw Food
    ctx.shadowColor = '#ff0055';
    ctx.fillStyle = '#ff0055';
    ctx.beginPath();
    ctx.arc(food.x * gridSize + gridSize/2, food.y * gridSize + gridSize/2, gridSize/2 - 2, 0, Math.PI*2);
    ctx.fill();

    ctx.shadowBlur = 0; // Reset
  }, [snake, food]);

  return (
    <div className="flex flex-col items-center">
      <canvas ref={canvasRef} width={500} height={500} className="rounded-lg border-2 border-emerald-500/30 w-full max-w-[500px] h-auto aspect-square" />
      {/* Mobile Controls */}
      <div className="grid grid-cols-3 gap-2 mt-4 md:hidden">
        <div></div>
        <button onClick={() => handleTouch('UP')} className="p-4 bg-gray-800 rounded-full active:bg-gray-700"><ChevronRight className="-rotate-90" /></button>
        <div></div>
        <button onClick={() => handleTouch('LEFT')} className="p-4 bg-gray-800 rounded-full active:bg-gray-700"><ChevronRight className="rotate-180" /></button>
        <button onClick={() => handleTouch('DOWN')} className="p-4 bg-gray-800 rounded-full active:bg-gray-700"><ChevronRight className="rotate-90" /></button>
        <button onClick={() => handleTouch('RIGHT')} className="p-4 bg-gray-800 rounded-full active:bg-gray-700"><ChevronRight /></button>
      </div>
    </div>
  );
};

// --- GAME 2: CYBER BREAKOUT ---
const BreakoutGame = ({ onGameOver, onScoreUpdate }) => {
  const canvasRef = useRef(null);
  const [score, setScore] = useState(0);
  const [gameState, setGameState] = useState('playing'); // playing, won, lost

  // Game State Refs (to avoid re-renders on every frame)
  const ball = useRef({ x: 250, y: 250, dx: 4, dy: -4, radius: 6 });
  const paddle = useRef({ x: 200, width: 100, height: 15 });
  const bricks = useRef([]);

  // Init Bricks
  useEffect(() => {
    const newBricks = [];
    for(let c=0; c<7; c++) {
        for(let r=0; r<5; r++) {
            newBricks.push({ x: c*(65)+25, y: r*(25)+30, w: 55, h: 15, status: 1 });
        }
    }
    bricks.current = newBricks;
  }, []);

  // Input
  useEffect(() => {
    const handleMove = (e) => {
       const canvas = canvasRef.current;
       if(!canvas) return;
       const rect = canvas.getBoundingClientRect();
       let clientX = e.clientX;
       // Handle touch
       if (e.touches && e.touches.length > 0) {
         clientX = e.touches[0].clientX;
       }
       
       const relativeX = clientX - rect.left;
       const scaleX = canvas.width / rect.width; // Scale for responsive canvas
       
       if(relativeX > 0 && relativeX < rect.width) {
           paddle.current.x = (relativeX * scaleX) - paddle.current.width/2;
       }
    };

    window.addEventListener('mousemove', handleMove);
    window.addEventListener('touchmove', handleMove, { passive: false });
    return () => {
        window.removeEventListener('mousemove', handleMove);
        window.removeEventListener('touchmove', handleMove);
    }
  }, []);

  useGameLoop(() => {
    if(gameState !== 'playing') return;
    
    const b = ball.current;
    const p = paddle.current;
    const cvs = canvasRef.current;
    if(!cvs) return;
    const ctx = cvs.getContext('2d');

    // Update logic
    b.x += b.dx;
    b.y += b.dy;

    // Wall collision
    if(b.x + b.radius > cvs.width || b.x - b.radius < 0) b.dx = -b.dx;
    if(b.y - b.radius < 0) b.dy = -b.dy;
    else if(b.y + b.radius > cvs.height) {
        setGameState('lost');
        onGameOver(score);
    }

    // Paddle collision
    if(b.y + b.radius > cvs.height - p.height - 10 && 
       b.x > p.x && b.x < p.x + p.width) {
        b.dy = -Math.abs(b.dy * 1.05); // Speed up slightly
    }

    // Brick collision
    let activeBricksCount = 0;
    bricks.current.forEach(brick => {
        if(brick.status === 1) {
            activeBricksCount++;
            if(b.x > brick.x && b.x < brick.x + brick.w && b.y > brick.y && b.y < brick.y + brick.h) {
                b.dy = -b.dy;
                brick.status = 0;
                const newScore = score + 20;
                setScore(newScore);
                onScoreUpdate(newScore);
            }
        }
    });

    if(activeBricksCount === 0) {
        setGameState('won');
        onGameOver(score + 1000);
    }

    // Draw
    ctx.fillStyle = '#111827';
    ctx.fillRect(0, 0, cvs.width, cvs.height);

    // Draw Bricks
    bricks.current.forEach(brick => {
        if(brick.status === 1) {
            ctx.fillStyle = `hsl(${brick.x}, 70%, 60%)`;
            ctx.shadowBlur = 10;
            ctx.shadowColor = `hsl(${brick.x}, 70%, 60%)`;
            ctx.beginPath();
            ctx.roundRect(brick.x, brick.y, brick.w, brick.h, 5);
            ctx.fill();
        }
    });

    // Draw Paddle
    ctx.fillStyle = '#3b82f6';
    ctx.shadowColor = '#3b82f6';
    ctx.shadowBlur = 15;
    ctx.beginPath();
    ctx.roundRect(p.x, cvs.height - p.height - 10, p.width, p.height, 8);
    ctx.fill();

    // Draw Ball
    ctx.fillStyle = '#fff';
    ctx.shadowColor = '#fff';
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.radius, 0, Math.PI*2);
    ctx.fill();
    ctx.shadowBlur = 0;

  }, gameState === 'playing');

  return (
    <div className="flex flex-col items-center w-full">
      <canvas ref={canvasRef} width={500} height={500} className="rounded-lg border-2 border-blue-500/30 w-full max-w-[500px] h-auto aspect-square touch-none cursor-none" />
      <p className="mt-4 text-gray-400 text-sm md:block hidden">Move mouse to control paddle</p>
      <p className="mt-4 text-gray-400 text-sm md:hidden block">Drag finger to control paddle</p>
    </div>
  );
}

// --- GAME 3: VOID DODGER ---
const DodgerGame = ({ onGameOver, onScoreUpdate }) => {
  const canvasRef = useRef(null);
  const [score, setScore] = useState(0);
  const [gameState, setGameState] = useState('playing');
  
  const player = useRef({ x: 250, y: 450, w: 30, h: 30 });
  const enemies = useRef([]);
  const frameCount = useRef(0);

  // Input
  useEffect(() => {
     const handleMove = (e) => {
        const canvas = canvasRef.current;
        if(!canvas) return;
        const rect = canvas.getBoundingClientRect();
        let clientX = e.clientX;
        if (e.touches && e.touches.length > 0) clientX = e.touches[0].clientX;
        
        const relativeX = clientX - rect.left;
        const scaleX = canvas.width / rect.width;

        if(relativeX > 0 && relativeX < rect.width) {
            player.current.x = (relativeX * scaleX) - player.current.w/2;
        }
     };
     window.addEventListener('mousemove', handleMove);
     window.addEventListener('touchmove', handleMove, { passive: false });
     return () => {
         window.removeEventListener('mousemove', handleMove);
         window.removeEventListener('touchmove', handleMove);
     }
  }, []);

  useGameLoop(() => {
    if (gameState !== 'playing') return;
    
    const cvs = canvasRef.current;
    const ctx = cvs.getContext('2d');
    frameCount.current++;

    // Spawn Enemies
    if (frameCount.current % 40 === 0) {
        const size = Math.random() * 30 + 20;
        enemies.current.push({
            x: Math.random() * (cvs.width - size),
            y: -50,
            w: size,
            h: size,
            speed: Math.random() * 3 + 2 + (score / 500)
        });
    }

    // Update Enemies & Collision
    for (let i = enemies.current.length - 1; i >= 0; i--) {
        let e = enemies.current[i];
        e.y += e.speed;

        // Collision
        if (player.current.x < e.x + e.w &&
            player.current.x + player.current.w > e.x &&
            player.current.y < e.y + e.h &&
            player.current.y + player.current.h > e.y) {
             setGameState('lost');
             onGameOver(score);
        }

        // Remove if off screen
        if (e.y > cvs.height) {
            enemies.current.splice(i, 1);
            const newScore = score + 10;
            setScore(newScore);
            onScoreUpdate(newScore);
        }
    }

    // Draw
    ctx.fillStyle = '#111827';
    ctx.fillRect(0, 0, cvs.width, cvs.height);

    // Draw Player
    ctx.shadowBlur = 20;
    ctx.shadowColor = '#a855f7';
    ctx.fillStyle = '#a855f7';
    ctx.beginPath();
    ctx.moveTo(player.current.x + player.current.w/2, player.current.y);
    ctx.lineTo(player.current.x + player.current.w, player.current.y + player.current.h);
    ctx.lineTo(player.current.x, player.current.y + player.current.h);
    ctx.fill();

    // Draw Enemies
    ctx.shadowColor = '#f97316';
    ctx.fillStyle = '#f97316';
    enemies.current.forEach(e => {
        ctx.beginPath();
        ctx.arc(e.x + e.w/2, e.y + e.h/2, e.w/2, 0, Math.PI*2);
        ctx.fill();
    });
    
    ctx.shadowBlur = 0;

  }, gameState === 'playing');

  return (
    <div className="flex flex-col items-center w-full">
      <canvas ref={canvasRef} width={500} height={500} className="rounded-lg border-2 border-purple-500/30 w-full max-w-[500px] h-auto aspect-square touch-none" />
       <p className="mt-4 text-gray-400 text-sm">Dodge the falling meteors!</p>
    </div>
  );
}

// --- GAME 4: BATTLE ARENA (Zombie Horde) ---
const BattleArenaGame = ({ onGameOver, onScoreUpdate }) => {
  const canvasRef = useRef(null);
  const [score, setScore] = useState(0);
  const [gameState, setGameState] = useState('playing');
  
  // Game State
  const player = useRef({ x: 250, y: 250, size: 15, speed: 4 });
  const bullets = useRef([]);
  const enemies = useRef([]);
  const keys = useRef({});
  const mouse = useRef({ x: 0, y: 0 });
  const frameCount = useRef(0);

  // Input
  useEffect(() => {
      const handleKeyDown = (e) => keys.current[e.key] = true;
      const handleKeyUp = (e) => keys.current[e.key] = false;
      const handleMouseMove = (e) => {
         const canvas = canvasRef.current;
         if(!canvas) return;
         const rect = canvas.getBoundingClientRect();
         const scaleX = canvas.width / rect.width;
         const scaleY = canvas.height / rect.height;
         mouse.current = { 
             x: (e.clientX - rect.left) * scaleX, 
             y: (e.clientY - rect.top) * scaleY 
         };
      };
      const handleMouseDown = () => {
          if (gameState !== 'playing') return;
          const dx = mouse.current.x - player.current.x;
          const dy = mouse.current.y - player.current.y;
          const dist = Math.sqrt(dx*dx + dy*dy);
          bullets.current.push({
              x: player.current.x,
              y: player.current.y,
              vx: (dx/dist) * 10,
              vy: (dy/dist) * 10
          });
      };

      window.addEventListener('keydown', handleKeyDown);
      window.addEventListener('keyup', handleKeyUp);
      window.addEventListener('mousemove', handleMouseMove);
      window.addEventListener('mousedown', handleMouseDown);
      return () => {
          window.removeEventListener('keydown', handleKeyDown);
          window.removeEventListener('keyup', handleKeyUp);
          window.removeEventListener('mousemove', handleMouseMove);
          window.removeEventListener('mousedown', handleMouseDown);
      }
  }, [gameState]);

  useGameLoop(() => {
    if (gameState !== 'playing') return;
    const cvs = canvasRef.current;
    const ctx = cvs.getContext('2d');
    frameCount.current++;

    // Player Movement
    if(keys.current['w'] || keys.current['ArrowUp']) player.current.y -= player.current.speed;
    if(keys.current['s'] || keys.current['ArrowDown']) player.current.y += player.current.speed;
    if(keys.current['a'] || keys.current['ArrowLeft']) player.current.x -= player.current.speed;
    if(keys.current['d'] || keys.current['ArrowRight']) player.current.x += player.current.speed;
    
    // Clamp Player
    player.current.x = Math.max(10, Math.min(cvs.width - 10, player.current.x));
    player.current.y = Math.max(10, Math.min(cvs.height - 10, player.current.y));

    // Spawn Enemies
    if (frameCount.current % 60 === 0) {
        const angle = Math.random() * Math.PI * 2;
        const r = 300; // Spawn distance
        enemies.current.push({
            x: player.current.x + Math.cos(angle) * r,
            y: player.current.y + Math.sin(angle) * r,
            speed: 1 + Math.random() * 1.5,
            hp: 1
        });
    }

    // Update Bullets
    for (let i = bullets.current.length - 1; i >= 0; i--) {
        let b = bullets.current[i];
        b.x += b.vx;
        b.y += b.vy;
        if (b.x < 0 || b.x > cvs.width || b.y < 0 || b.y > cvs.height) {
            bullets.current.splice(i, 1);
        }
    }

    // Update Enemies & Collisions
    for (let i = enemies.current.length - 1; i >= 0; i--) {
        let e = enemies.current[i];
        const dx = player.current.x - e.x;
        const dy = player.current.y - e.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        
        // Move towards player
        e.x += (dx/dist) * e.speed;
        e.y += (dy/dist) * e.speed;

        // Hit Player
        if (dist < player.current.size + 10) {
            setGameState('lost');
            onGameOver(score);
        }

        // Hit by Bullet
        for (let j = bullets.current.length - 1; j >= 0; j--) {
            let b = bullets.current[j];
            const bdx = b.x - e.x;
            const bdy = b.y - e.y;
            if (Math.sqrt(bdx*bdx + bdy*bdy) < 15) {
                bullets.current.splice(j, 1);
                enemies.current.splice(i, 1);
                const newScore = score + 50;
                setScore(newScore);
                onScoreUpdate(newScore);
                break; // Stop checking bullets for this dead enemy
            }
        }
    }

    // Draw
    ctx.fillStyle = '#2f3136'; // Battlefield color
    ctx.fillRect(0, 0, cvs.width, cvs.height);

    // Draw Grid
    ctx.strokeStyle = '#40444b';
    ctx.lineWidth = 1;
    ctx.beginPath();
    for(let x=0; x<cvs.width; x+=40) { ctx.moveTo(x,0); ctx.lineTo(x,cvs.height); }
    for(let y=0; y<cvs.height; y+=40) { ctx.moveTo(0,y); ctx.lineTo(cvs.width,y); }
    ctx.stroke();

    // Draw Player
    ctx.save();
    ctx.translate(player.current.x, player.current.y);
    const aimAngle = Math.atan2(mouse.current.y - player.current.y, mouse.current.x - player.current.x);
    ctx.rotate(aimAngle);
    ctx.fillStyle = '#3ba55c'; // Green soldier
    ctx.beginPath();
    ctx.arc(0, 0, player.current.size, 0, Math.PI*2);
    ctx.fill();
    ctx.fillStyle = '#222'; // Gun
    ctx.fillRect(0, -3, 25, 6);
    ctx.restore();

    // Draw Enemies
    ctx.fillStyle = '#ed4245'; // Red enemies
    enemies.current.forEach(e => {
        ctx.beginPath();
        ctx.arc(e.x, e.y, 10, 0, Math.PI*2);
        ctx.fill();
    });

    // Draw Bullets
    ctx.fillStyle = '#f1c40f'; // Yellow bullets
    bullets.current.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, 4, 0, Math.PI*2);
        ctx.fill();
    });

  }, gameState === 'playing');

  return (
    <div className="flex flex-col items-center w-full">
      <canvas ref={canvasRef} width={600} height={450} className="rounded-lg border-2 border-gray-600 w-full max-w-[600px] h-auto shadow-2xl cursor-crosshair" />
      <div className="mt-4 flex space-x-4 text-gray-400 text-sm">
          <span className="flex items-center"><kbd className="px-2 py-1 bg-gray-700 rounded mr-2">WASD</kbd> Move</span>
          <span className="flex items-center"><kbd className="px-2 py-1 bg-gray-700 rounded mr-2">Click</kbd> Shoot</span>
      </div>
    </div>
  );
}

// --- GAME 5: ISLAND SURVIVAL (Free Fire Style) ---
const IslandSurvivalGame = ({ onGameOver, onScoreUpdate }) => {
  const canvasRef = useRef(null);
  const [aliveCount, setAliveCount] = useState(30);
  const [playerHealth, setPlayerHealth] = useState(100);
  const [gameState, setGameState] = useState('playing');
  const [zoneWarning, setZoneWarning] = useState('');
  
  // Game Constants
  const MAP_SIZE = 1500;
  const VIEWPORT_W = 600;
  const VIEWPORT_H = 450;

  // Refs for mutable game state
  const player = useRef({ x: 750, y: 750, angle: 0, speed: 4, r: 12 });
  const bullets = useRef([]);
  const bots = useRef([]);
  const particles = useRef([]); // For hit effects
  const zone = useRef({ x: 750, y: 750, radius: 1000, shrinkRate: 0.4 });
  const keys = useRef({});
  const mouse = useRef({ x: 0, y: 0 });
  const camera = useRef({ x: 0, y: 0 });
  const frameCount = useRef(0);

  // Init Bots
  useEffect(() => {
      const newBots = [];
      for(let i=0; i<29; i++) {
          newBots.push({
              x: Math.random() * MAP_SIZE,
              y: Math.random() * MAP_SIZE,
              hp: 100,
              state: 'wander', // wander, chase
              targetX: Math.random() * MAP_SIZE,
              targetY: Math.random() * MAP_SIZE,
              speed: 2 + Math.random()
          });
      }
      bots.current = newBots;
      setAliveCount(30);
  }, []);

  // Input Listeners
  useEffect(() => {
    const handleKeyDown = (e) => keys.current[e.key] = true;
    const handleKeyUp = (e) => keys.current[e.key] = false;
    const handleMouseMove = (e) => {
       const cvs = canvasRef.current;
       if(!cvs) return;
       const rect = cvs.getBoundingClientRect();
       const scaleX = cvs.width / rect.width;
       const scaleY = cvs.height / rect.height;
       mouse.current = { 
           x: (e.clientX - rect.left) * scaleX, 
           y: (e.clientY - rect.top) * scaleY 
       };
    };
    const handleMouseDown = () => {
        if (gameState !== 'playing' || playerHealth <= 0) return;
        // Spawn bullet from player center towards mouse (in world space)
        // Mouse is screen space, need to convert to world
        const worldMouseX = mouse.current.x + camera.current.x;
        const worldMouseY = mouse.current.y + camera.current.y;
        const angle = Math.atan2(worldMouseY - player.current.y, worldMouseX - player.current.x);
        
        bullets.current.push({
            x: player.current.x,
            y: player.current.y,
            vx: Math.cos(angle) * 15,
            vy: Math.sin(angle) * 15,
            owner: 'player',
            dist: 0
        });
    };

    window.addEventListener('keydown', handleKeyDown);
    window.addEventListener('keyup', handleKeyUp);
    window.addEventListener('mousemove', handleMouseMove);
    window.addEventListener('mousedown', handleMouseDown);
    return () => {
        window.removeEventListener('keydown', handleKeyDown);
        window.removeEventListener('keyup', handleKeyUp);
        window.removeEventListener('mousemove', handleMouseMove);
        window.removeEventListener('mousedown', handleMouseDown);
    }
  }, [gameState, playerHealth]);

  // Game Loop
  useGameLoop((dt) => {
    if(gameState !== 'playing') return;
    const cvs = canvasRef.current;
    const ctx = cvs.getContext('2d');
    frameCount.current++;

    // --- LOGIC ---

    // 1. Zone Logic
    if(zone.current.radius > 100) {
        zone.current.radius -= zone.current.shrinkRate;
    }
    
    // Check Zone Damage (every 60 frames approx 1 sec)
    if(frameCount.current % 60 === 0) {
        const distToZone = Math.hypot(player.current.x - zone.current.x, player.current.y - zone.current.y);
        if(distToZone > zone.current.radius) {
            setPlayerHealth(h => {
                const nh = h - 5;
                if(nh <= 0) {
                    setGameState('lost');
                    onGameOver(30 - bots.current.length); // Score is kills approx
                }
                return nh;
            });
            setZoneWarning("WARNING: OUTSIDE SAFE ZONE!");
        } else {
            setZoneWarning("");
        }
    }

    // 2. Player Movement
    let moveX = 0; 
    let moveY = 0;
    if(keys.current['w'] || keys.current['ArrowUp']) moveY = -1;
    if(keys.current['s'] || keys.current['ArrowDown']) moveY = 1;
    if(keys.current['a'] || keys.current['ArrowLeft']) moveX = -1;
    if(keys.current['d'] || keys.current['ArrowRight']) moveX = 1;

    // Normalize diagonal
    if(moveX !== 0 && moveY !== 0) {
        moveX *= 0.707;
        moveY *= 0.707;
    }
    player.current.x += moveX * player.current.speed;
    player.current.y += moveY * player.current.speed;

    // Clamp Map
    player.current.x = Math.max(0, Math.min(MAP_SIZE, player.current.x));
    player.current.y = Math.max(0, Math.min(MAP_SIZE, player.current.y));

    // Update Camera (Center on player)
    camera.current.x = player.current.x - VIEWPORT_W/2;
    camera.current.y = player.current.y - VIEWPORT_H/2;

    // 3. Bots Logic
    bots.current.forEach(bot => {
        // Simple AI
        const distToPlayer = Math.hypot(bot.x - player.current.x, bot.y - player.current.y);
        
        // Bot Shoots at player if close
        if(distToPlayer < 300 && Math.random() < 0.02) {
            const angle = Math.atan2(player.current.y - bot.y, player.current.x - bot.x);
            bullets.current.push({
                x: bot.x,
                y: bot.y,
                vx: Math.cos(angle) * 10,
                vy: Math.sin(angle) * 10,
                owner: 'bot',
                dist: 0
            });
        }

        // Bot Move
        if(Math.hypot(bot.x - bot.targetX, bot.y - bot.targetY) < 10 || frameCount.current % 120 === 0) {
            // Pick new target (biased towards center to simulate running from gas)
            bot.targetX = Math.random() * MAP_SIZE * 0.8 + MAP_SIZE * 0.1;
            bot.targetY = Math.random() * MAP_SIZE * 0.8 + MAP_SIZE * 0.1;
        }
        const dx = bot.targetX - bot.x;
        const dy = bot.targetY - bot.y;
        const d = Math.hypot(dx, dy);
        bot.x += (dx/d) * bot.speed;
        bot.y += (dy/d) * bot.speed;
    });

    // 4. Bullets Update
    for (let i = bullets.current.length - 1; i >= 0; i--) {
        let b = bullets.current[i];
        b.x += b.vx;
        b.y += b.vy;
        b.dist += 1; // Life time

        // Remove old bullets
        if (b.dist > 60) {
            bullets.current.splice(i, 1);
            continue;
        }

        // Check Collisions
        if(b.owner === 'player') {
            // Check vs Bots
            for(let j=bots.current.length-1; j>=0; j--) {
                let bot = bots.current[j];
                if(Math.hypot(b.x - bot.x, b.y - bot.y) < 20) {
                    bot.hp -= 35;
                    bullets.current.splice(i, 1);
                    
                    // Hit effect
                    particles.current.push({x: bot.x, y: bot.y, life: 10, color: '#f00'});

                    if(bot.hp <= 0) {
                        bots.current.splice(j, 1);
                        const kills = 30 - (bots.current.length + 1);
                        onScoreUpdate(kills * 100); // Score based on kills
                        setAliveCount(bots.current.length + 1);
                        
                        if(bots.current.length === 0) {
                            setGameState('won');
                            onGameOver(5000); // Big bonus
                        }
                    }
                    break;
                }
            }
        } else {
            // Check vs Player
            if(Math.hypot(b.x - player.current.x, b.y - player.current.y) < 15) {
                setPlayerHealth(h => {
                    const nh = h - 10;
                    if(nh <= 0 && gameState !== 'lost') {
                         setGameState('lost');
                         onGameOver((30 - bots.current.length) * 100);
                    }
                    return nh;
                });
                bullets.current.splice(i, 1);
                particles.current.push({x: player.current.x, y: player.current.y, life: 10, color: '#f00'});
            }
        }
    }

    // --- DRAWING ---
    
    // 1. Draw Grass Map
    ctx.save();
    ctx.translate(-camera.current.x, -camera.current.y);
    
    ctx.fillStyle = '#3f6b2b'; // Grass Green
    ctx.fillRect(0, 0, MAP_SIZE, MAP_SIZE);
    
    // Draw Grid for texture
    ctx.strokeStyle = '#345e23';
    ctx.lineWidth = 2;
    ctx.beginPath();
    for(let x=0; x<=MAP_SIZE; x+=100) { ctx.moveTo(x, 0); ctx.lineTo(x, MAP_SIZE); }
    for(let y=0; y<=MAP_SIZE; y+=100) { ctx.moveTo(0, y); ctx.lineTo(MAP_SIZE, y); }
    ctx.stroke();

    // 2. Draw Safe Zone
    ctx.beginPath();
    ctx.arc(zone.current.x, zone.current.y, zone.current.radius, 0, Math.PI*2);
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 5;
    ctx.stroke();
    // Draw Danger overlay outside zone (simple large rect subtraction trick for performance or just draw huge border)
    // Actually, drawing inverse circle is hard in 2D, so we just draw the line for now.
    
    // 3. Draw Bots
    ctx.fillStyle = '#ef4444';
    bots.current.forEach(bot => {
        ctx.beginPath();
        ctx.arc(bot.x, bot.y, 12, 0, Math.PI*2);
        ctx.fill();
        // Health bar
        ctx.fillStyle = '#000';
        ctx.fillRect(bot.x - 15, bot.y - 20, 30, 4);
        ctx.fillStyle = '#0f0';
        ctx.fillRect(bot.x - 15, bot.y - 20, 30 * (bot.hp/100), 4);
        ctx.fillStyle = '#ef4444';
    });

    // 4. Draw Player
    ctx.fillStyle = '#3b82f6';
    ctx.beginPath();
    ctx.arc(player.current.x, player.current.y, 12, 0, Math.PI*2);
    ctx.fill();
    // Gun
    ctx.save();
    ctx.translate(player.current.x, player.current.y);
    const mouseAngle = Math.atan2(mouse.current.y + camera.current.y - player.current.y, mouse.current.x + camera.current.x - player.current.x);
    ctx.rotate(mouseAngle);
    ctx.fillStyle = '#1f2937';
    ctx.fillRect(0, -4, 20, 8);
    ctx.restore();

    // 5. Draw Bullets
    ctx.fillStyle = '#fbbf24';
    bullets.current.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, 3, 0, Math.PI*2);
        ctx.fill();
    });

    // 6. Draw Particles (Blood)
    particles.current.forEach((p, i) => {
        p.life--;
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life / 10;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 5, 0, Math.PI*2);
        ctx.fill();
        ctx.globalAlpha = 1;
        if(p.life <= 0) particles.current.splice(i, 1);
    });

    ctx.restore();

    // --- HUD (Screen Space) ---
    // Zone Warning
    if(zoneWarning) {
        ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
        ctx.fillRect(0, 0, cvs.width, cvs.height);
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 24px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(zoneWarning, cvs.width/2, 100);
    }
    
  }, gameState === 'playing');

  return (
      <div className="flex flex-col items-center w-full relative">
          {gameState === 'won' && (
              <div className="absolute inset-0 z-10 flex items-center justify-center flex-col bg-yellow-500/80 backdrop-blur-sm rounded-lg">
                  <h2 className="text-6xl font-black text-white drop-shadow-xl italic transform -skew-x-12">BOOYAH!</h2>
                  <p className="text-white font-bold mt-2 text-xl">#1 VICTORY ROYALE</p>
              </div>
          )}
          
          {/* HUD Header */}
          <div className="absolute top-4 left-4 right-4 flex justify-between text-white font-bold text-shadow z-10 pointer-events-none">
              <div className="flex items-center space-x-2 bg-black/50 px-3 py-1 rounded-full">
                  <Heart size={16} className="text-red-500 fill-red-500" />
                  <span>{Math.ceil(playerHealth)}%</span>
              </div>
              <div className="flex items-center space-x-2 bg-black/50 px-3 py-1 rounded-full">
                  <Skull size={16} className="text-gray-300" />
                  <span>{30 - aliveCount} Kills</span>
              </div>
              <div className="flex items-center space-x-2 bg-black/50 px-3 py-1 rounded-full">
                  <span className="text-yellow-400">ALIVE</span>
                  <span className="text-2xl">{aliveCount}</span>
              </div>
          </div>

          <canvas ref={canvasRef} width={600} height={450} className="rounded-lg border-2 border-gray-600 w-full max-w-[600px] h-auto shadow-2xl cursor-crosshair bg-gray-800" />
          
          <div className="mt-4 flex space-x-4 text-gray-400 text-sm">
              <span className="flex items-center"><kbd className="px-2 py-1 bg-gray-700 rounded mr-2">WASD</kbd> Move</span>
              <span className="flex items-center"><kbd className="px-2 py-1 bg-gray-700 rounded mr-2">Click</kbd> Fire</span>
              <span className="flex items-center"><AlertTriangle size={14} className="mr-1 text-yellow-500" /> Stay in Circle</span>
          </div>
      </div>
  );
}


// --- UI COMPONENTS ---

const GameCard = ({ game, onPlay, isPremium, onOpenSubscribe }) => {
  const isLocked = game.premium && !isPremium;

  const handleClick = () => {
      if (isLocked) {
          onOpenSubscribe();
      } else {
          onPlay(game);
      }
  };

  return (
      <div 
        onClick={handleClick}
        className="group relative bg-gray-800/50 rounded-2xl overflow-hidden border border-gray-700 hover:border-purple-500 transition-all duration-300 cursor-pointer hover:shadow-2xl hover:shadow-purple-500/20 flex flex-col"
      >
        {/* Image/Gradient Area */}
        <div className={`h-48 w-full bg-gradient-to-br ${game.gradient} flex items-center justify-center relative overflow-hidden`}>
           <div className={`absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors duration-300 ${isLocked ? 'backdrop-blur-sm bg-black/60' : ''}`} />
           
           {isLocked ? (
               <Lock size={48} className="text-gray-300/80 drop-shadow-lg" />
           ) : (
               <game.icon size={64} className="text-white drop-shadow-lg transform group-hover:scale-110 transition-transform duration-300" />
           )}

           <div className="absolute top-3 right-3 bg-black/60 backdrop-blur-sm px-2 py-1 rounded-lg flex items-center space-x-1">
             <Star size={14} className="text-yellow-400 fill-yellow-400" />
             <span className="text-xs font-bold text-white">{game.rating}</span>
           </div>
           {game.premium && (
               <div className="absolute top-3 left-3 bg-yellow-500 text-black font-bold text-[10px] px-2 py-0.5 rounded uppercase tracking-wider flex items-center">
                   <Crown size={10} className="mr-1 fill-black" /> PREMIUM
               </div>
           )}
        </div>
        
        {/* Info Area */}
        <div className="p-5 flex-1 flex flex-col">
          <div className="flex justify-between items-start mb-2">
            <h3 className="text-lg font-bold text-white group-hover:text-purple-400 transition-colors">{game.title}</h3>
          </div>
          <p className="text-gray-400 text-sm mb-4 line-clamp-2">{game.description}</p>
          <div className="mt-auto flex items-center justify-between">
            <span className="text-xs font-medium text-gray-500 uppercase tracking-wider">{game.category}</span>
            <button className={`${isLocked ? 'bg-gray-700' : 'bg-purple-600 hover:bg-purple-700'} text-white p-2 rounded-full transition-colors`}>
                {isLocked ? <Lock size={16} /> : <Play size={16} fill="currentColor" />}
            </button>
          </div>
        </div>
      </div>
  );
}

const Navbar = ({ onSearch, activeCategory, onCategoryChange, isPremium, onOpenSubscribe }) => (
  <nav className="sticky top-0 z-40 w-full bg-gray-900/90 backdrop-blur-md border-b border-gray-800">
    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div className="flex items-center justify-between h-20">
        {/* Logo */}
        <div className="flex-shrink-0 flex items-center space-x-2 cursor-pointer" onClick={() => window.location.reload()}>
          <div className="bg-gradient-to-r from-purple-600 to-blue-600 p-2 rounded-lg relative">
            <Gamepad2 className="text-white h-6 w-6" />
            {isPremium && <div className="absolute -top-1 -right-1 w-3 h-3 bg-yellow-400 rounded-full border-2 border-gray-900"></div>}
          </div>
          <span className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400 hidden sm:block">
            NEXUS
          </span>
        </div>

        {/* Search */}
        <div className="flex-1 max-w-lg mx-4 hidden md:block">
          <div className="relative">
            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <Search className="h-5 w-5 text-gray-500" />
            </div>
            <input
              type="text"
              onChange={(e) => onSearch(e.target.value)}
              className="block w-full pl-10 pr-3 py-2.5 border border-gray-700 rounded-full leading-5 bg-gray-800 text-gray-300 placeholder-gray-500 focus:outline-none focus:bg-gray-700 focus:border-purple-500 focus:ring-1 focus:ring-purple-500 sm:text-sm transition-all"
              placeholder="Search games..."
            />
          </div>
        </div>

        {/* Mobile Search Icon (visible only on mobile) */}
        <div className="md:hidden text-gray-400">
            <Search className="h-6 w-6" />
        </div>

        {/* Actions */}
        <div className="flex items-center space-x-4">
           {!isPremium ? (
               <button 
                onClick={onOpenSubscribe}
                className="hidden sm:flex items-center px-4 py-2 bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-black font-bold text-xs uppercase tracking-wider rounded-full shadow-lg shadow-yellow-500/20 transition-all transform hover:scale-105"
               >
                   <Crown size={14} className="mr-1.5" /> Go Pro
               </button>
           ) : (
                <div className="hidden sm:flex items-center px-3 py-1 bg-gray-800 border border-yellow-500/50 rounded-full">
                    <Crown size={14} className="text-yellow-400 mr-1.5 fill-yellow-400" />
                    <span className="text-yellow-400 font-bold text-xs">PRO MEMBER</span>
                </div>
           )}

           <button className="text-gray-400 hover:text-white transition-colors">
               <Heart className="h-6 w-6" />
           </button>
           <div className={`h-8 w-8 rounded-full p-[2px] ${isPremium ? 'bg-gradient-to-tr from-yellow-400 via-orange-500 to-red-500' : 'bg-gradient-to-tr from-pink-500 to-yellow-500'}`}>
              <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" className="rounded-full bg-gray-900" />
           </div>
        </div>
      </div>
      
      {/* Categories */}
      <div className="flex space-x-8 overflow-x-auto pb-4 scrollbar-hide">
        {['All', 'Battle Royale', 'Action', 'Arcade', 'Strategy', 'Puzzle'].map((cat) => (
          <button
            key={cat}
            onClick={() => onCategoryChange(cat)}
            className={`whitespace-nowrap text-sm font-medium transition-colors ${
              activeCategory === cat ? 'text-purple-400 border-b-2 border-purple-400 pb-1' : 'text-gray-400 hover:text-white'
            }`}
          >
            {cat}
          </button>
        ))}
      </div>
    </div>
  </nav>
);

const Hero = ({ featuredGame, onPlay, isPremium, onOpenSubscribe }) => {
    const isLocked = featuredGame.premium && !isPremium;

    const handleClick = () => {
        if(isLocked) onOpenSubscribe();
        else onPlay(featuredGame);
    }

    return (
    <div className="relative bg-gray-900 overflow-hidden">
        <div className="absolute inset-0">
             <div className="absolute inset-0 bg-gradient-to-r from-gray-900 via-gray-900/95 to-transparent z-10" />
             <div className={`w-full h-full bg-gradient-to-br ${featuredGame.gradient} opacity-30`} />
        </div>
        
        <div className="relative z-20 max-w-7xl mx-auto py-16 px-4 sm:py-24 sm:px-6 lg:px-8 flex flex-col md:flex-row items-center">
            <div className="md:w-1/2">
                <div className="inline-flex items-center px-3 py-1 rounded-full bg-purple-900/50 border border-purple-500/30 text-purple-300 text-xs font-medium mb-6">
                    <Flame className="w-3 h-3 mr-1" /> Featured Game
                </div>
                <h1 className="text-4xl md:text-6xl font-extrabold tracking-tight text-white mb-4">
                    {featuredGame.title}
                </h1>
                <p className="text-lg text-gray-300 mb-8 max-w-xl">
                    {featuredGame.description} Experience stunning visuals and addictive gameplay right in your browser. No downloads required.
                </p>
                <div className="flex space-x-4">
                    <button 
                        onClick={handleClick}
                        className={`flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-full text-white ${isLocked ? 'bg-gray-700 hover:bg-gray-600' : 'bg-purple-600 hover:bg-purple-700 shadow-lg shadow-purple-600/30'} md:py-4 md:text-lg transition-all`}
                    >
                        {isLocked ? (
                            <><Lock className="w-5 h-5 mr-2" /> Unlock Pro to Play</>
                        ) : (
                            <><Play className="w-5 h-5 mr-2 fill-current" /> Play Now</>
                        )}
                    </button>
                    <button className="flex items-center justify-center px-8 py-3 border border-gray-600 text-base font-medium rounded-full text-gray-300 hover:bg-gray-800 md:py-4 md:text-lg transition-all">
                        More Info
                    </button>
                </div>
            </div>
            
            {/* Hero Visual */}
            <div className="md:w-1/2 mt-10 md:mt-0 flex justify-center">
                <div className="relative w-full max-w-md aspect-video bg-gray-800 rounded-2xl shadow-2xl overflow-hidden border border-gray-700 group cursor-pointer" onClick={handleClick}>
                    <div className={`absolute inset-0 bg-gradient-to-br ${featuredGame.gradient} opacity-80`} />
                    {isLocked && <div className="absolute inset-0 bg-black/50 backdrop-blur-sm z-10" />}
                    <div className="absolute inset-0 flex items-center justify-center z-20">
                        {isLocked ? (
                             <Lock size={80} className="text-white/80" />
                        ) : (
                             <featuredGame.icon size={100} className="text-white drop-shadow-2xl transform group-hover:scale-110 transition-transform duration-500" />
                        )}
                    </div>
                    {featuredGame.premium && (
                         <div className="absolute top-4 left-4 bg-yellow-500 text-black font-bold text-xs px-2 py-1 rounded z-20">PREMIUM</div>
                    )}
                    <div className="absolute bottom-4 right-4 bg-black/50 backdrop-blur-md px-3 py-1 rounded-lg text-white text-sm font-bold z-20">
                        4.9/5 Rating
                    </div>
                </div>
            </div>
        </div>
    </div>
    );
}

const GameModal = ({ game, onClose, isPremium, onOpenSubscribe }) => {
    const [score, setScore] = useState(0);
    const [highScore, setHighScore] = useState(0);
    const [gameStatus, setGameStatus] = useState('playing'); // playing, over
    const [lore, setLore] = useState("");
    const [isLoreLoading, setIsLoreLoading] = useState(false);

    const handleGameOver = (finalScore) => {
        setGameStatus('over');
        if(finalScore > highScore) setHighScore(finalScore);
    };

    const handleRestart = () => {
        setScore(0);
        setGameStatus('playing');
    };

    const generateLore = async () => {
        if (!isPremium) {
            onOpenSubscribe();
            return;
        }
        if (isLoreLoading) return;
        setIsLoreLoading(true);
        const prompt = `Generate a short, exciting, sci-fi/cyberpunk lore backstory (max 50 words) for a video game titled "${game.title}" which is about: ${game.description}. Make it sound epic.`;
        const text = await callGemini(prompt);
        setLore(text);
        setIsLoreLoading(false);
    };

    if (!game) return null;

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90 backdrop-blur-sm animate-in fade-in duration-200">
            <div className="bg-gray-900 border border-gray-700 w-full max-w-4xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                {/* Header */}
                <div className="p-4 border-b border-gray-800 flex justify-between items-center bg-gray-800/50">
                    <div className="flex items-center space-x-3">
                        <div className={`p-2 rounded-lg bg-gradient-to-br ${game.gradient}`}>
                            <game.icon size={20} className="text-white" />
                        </div>
                        <div>
                            <h3 className="text-white font-bold">{game.title}</h3>
                            <span className="text-xs text-gray-400">{game.category}</span>
                        </div>
                    </div>
                    <div className="flex items-center space-x-6">
                        {/* Lore Generator Button */}
                        {!lore && (
                            <button 
                                onClick={generateLore}
                                disabled={isLoreLoading}
                                className={`hidden sm:flex items-center px-3 py-1.5 border text-xs rounded-lg transition-all ${
                                    isPremium 
                                    ? 'bg-indigo-600/20 hover:bg-indigo-600/40 border-indigo-500/30 text-indigo-300' 
                                    : 'bg-gray-800 hover:bg-gray-700 border-gray-600 text-gray-400'
                                }`}
                            >
                                {isPremium ? (
                                    <><Sparkles size={14} className={`mr-1.5 ${isLoreLoading ? 'animate-spin' : ''}`} /> {isLoreLoading ? 'Generating...' : '✨ Expand Universe'}</>
                                ) : (
                                    <><Lock size={12} className="mr-1.5" /> Unlock Lore</>
                                )}
                            </button>
                        )}
                        
                         <div className="text-center hidden sm:block">
                            <p className="text-xs text-gray-500 uppercase">Score</p>
                            <p className="text-xl font-mono text-purple-400 font-bold">{score}</p>
                        </div>
                        <button onClick={onClose} className="p-2 hover:bg-gray-700 rounded-full text-gray-400 hover:text-white transition-colors">
                            <X size={24} />
                        </button>
                    </div>
                </div>

                {/* Lore Banner */}
                {lore && (
                     <div className="bg-indigo-900/20 border-b border-indigo-500/20 p-3 px-6 text-center">
                        <p className="text-indigo-200 text-sm italic font-medium animate-in fade-in slide-in-from-top-2">"{lore}"</p>
                    </div>
                )}

                {/* Game Container */}
                <div className="flex-1 bg-black/50 relative overflow-y-auto flex flex-col items-center justify-center p-4 md:p-8">
                    {gameStatus === 'playing' ? (
                        <>
                           {game.id === 'snake' && <SnakeGame onGameOver={handleGameOver} onScoreUpdate={setScore} />}
                           {game.id === 'breakout' && <BreakoutGame onGameOver={handleGameOver} onScoreUpdate={setScore} />}
                           {game.id === 'dodger' && <DodgerGame onGameOver={handleGameOver} onScoreUpdate={setScore} />}
                           {game.id === 'battle-royale' && <BattleArenaGame onGameOver={handleGameOver} onScoreUpdate={setScore} />}
                           {game.id === 'free-fire-clone' && <IslandSurvivalGame onGameOver={handleGameOver} onScoreUpdate={setScore} />}
                           
                           {/* Placeholder for non-implemented games */}
                           {(!['snake', 'breakout', 'dodger', 'battle-royale', 'free-fire-clone'].includes(game.id)) && (
                               <div className="text-center p-10">
                                   <game.icon size={80} className="mx-auto text-gray-600 mb-4" />
                                   <h3 className="text-2xl text-white font-bold mb-2">Coming Soon</h3>
                                   <p className="text-gray-400">This title is currently in development. Try our playable Battle Arena!</p>
                                   <button onClick={onClose} className="mt-6 px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-full">
                                       Go Back
                                   </button>
                               </div>
                           )}
                        </>
                    ) : (
                        <div className="text-center animate-in zoom-in duration-300">
                            <h2 className="text-4xl font-black text-white mb-2">GAME OVER</h2>
                            <p className="text-gray-400 mb-8">Nice try! Give it another shot.</p>
                            
                            <div className="grid grid-cols-2 gap-8 mb-8">
                                <div className="bg-gray-800 p-4 rounded-xl border border-gray-700">
                                    <p className="text-gray-500 text-sm uppercase">Your Score</p>
                                    <p className="text-3xl font-mono text-white">{score}</p>
                                </div>
                                <div className="bg-gray-800 p-4 rounded-xl border border-purple-500/30">
                                    <p className="text-purple-400 text-sm uppercase">High Score</p>
                                    <p className="text-3xl font-mono text-white">{highScore}</p>
                                </div>
                            </div>

                            <div className="flex space-x-4 justify-center">
                                <button onClick={handleRestart} className="flex items-center px-8 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-full font-bold transition-colors">
                                    <RotateCcw size={20} className="mr-2" /> Play Again
                                </button>
                                <button onClick={onClose} className="px-8 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-full font-medium transition-colors">
                                    Exit
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
};

// --- MAIN APP ---

const App = () => {
  const [activeCategory, setActiveCategory] = useState('All');
  const [searchQuery, setSearchQuery] = useState('');
  const [activeGame, setActiveGame] = useState(null);
  const [isPremium, setIsPremium] = useState(false);
  const [showSubscribeModal, setShowSubscribeModal] = useState(false);

  const games = [
    {
      id: 'free-fire-clone',
      title: 'Island Fire: Survival',
      category: 'Battle Royale',
      rating: 5.0,
      description: 'Drop onto a remote island, scavenge for weapons, and be the last survivor. Features a shrinking safe zone and intense bot battles.',
      icon: Map,
      gradient: 'from-yellow-500 to-orange-600',
      premium: true
    },
    {
      id: 'battle-royale',
      title: 'Cyber Battlegrounds',
      category: 'Battle Royale',
      rating: 4.9,
      description: 'Survive in a chaotic arena! Use WASD to move and Mouse to shoot enemies. Be the last one standing.',
      icon: Crosshair,
      gradient: 'from-red-600 to-orange-600',
      premium: true
    },
    {
      id: 'snake',
      title: 'Neon Snake',
      category: 'Arcade',
      rating: 4.8,
      description: 'The classic snake game reimagined with glowing neon visuals and smooth controls.',
      icon: Zap,
      gradient: 'from-green-400 to-blue-500',
      premium: false
    },
    {
      id: 'breakout',
      title: 'Cyber Breakout',
      category: 'Arcade',
      rating: 4.9,
      description: 'Smash through layers of digital bricks in this physics-based paddle game.',
      icon: LayoutGrid,
      gradient: 'from-blue-500 to-purple-600',
      premium: false
    },
    {
      id: 'pubg-pixel',
      title: 'Pixel PUBG',
      category: 'Battle Royale',
      rating: 4.7,
      description: 'Drop in, gear up, and battle it out in this pixel art rendition of the classic royale.',
      icon: Skull,
      gradient: 'from-yellow-500 to-yellow-700',
      premium: true
    },
    {
      id: 'fortress',
      title: 'Fortress Nite',
      category: 'Battle Royale',
      rating: 4.6,
      description: 'Build your defenses and eliminate opponents in a cartoon-style battle world.',
      icon: Shield,
      gradient: 'from-blue-400 to-indigo-500',
      premium: true
    },
    {
      id: 'apex',
      title: 'Apex Skirmish',
      category: 'Battle Royale',
      rating: 4.8,
      description: 'Fast-paced squad action in a futuristic frontier.',
      icon: Target,
      gradient: 'from-red-500 to-pink-600',
      premium: true
    },
    {
      id: 'dodger',
      title: 'Void Dodger',
      category: 'Action',
      rating: 4.7,
      description: 'Avoid the falling cosmic debris. How long can you survive in the void?',
      icon: Trophy,
      gradient: 'from-orange-400 to-pink-600',
      premium: false
    },
  ];

  const filteredGames = games.filter(game => {
    const matchesCategory = activeCategory === 'All' || game.category === activeCategory;
    const matchesSearch = game.title.toLowerCase().includes(searchQuery.toLowerCase());
    return matchesCategory && matchesSearch;
  });

  return (
    <div className="min-h-screen bg-gray-950 text-gray-100 font-sans selection:bg-purple-500 selection:text-white">
      <Navbar 
        activeCategory={activeCategory} 
        onCategoryChange={setActiveCategory} 
        onSearch={setSearchQuery} 
        isPremium={isPremium}
        onOpenSubscribe={() => setShowSubscribeModal(true)}
      />

      {!activeGame && (
        <>
            {!searchQuery && (
                <Hero 
                    featuredGame={games[0]} 
                    onPlay={setActiveGame} 
                    isPremium={isPremium}
                    onOpenSubscribe={() => setShowSubscribeModal(true)}
                />
            )}
            
            <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                <div className="flex items-center justify-between mb-8">
                    <h2 className="text-2xl font-bold text-white flex items-center">
                        <LayoutGrid className="mr-2 text-purple-500" /> 
                        {searchQuery ? 'Search Results' : 'Game Library'}
                    </h2>
                    <span className="text-gray-500 text-sm">{filteredGames.length} games found</span>
                </div>

                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    {filteredGames.map(game => (
                        <GameCard 
                            key={game.id} 
                            game={game} 
                            onPlay={setActiveGame} 
                            isPremium={isPremium}
                            onOpenSubscribe={() => setShowSubscribeModal(true)}
                        />
                    ))}
                    {filteredGames.length === 0 && (
                        <div className="col-span-full text-center py-20 text-gray-500">
                            <Search className="h-12 w-12 mx-auto mb-4 opacity-20" />
                            <p>No games found matching your criteria.</p>
                        </div>
                    )}
                </div>
            </main>

            <footer className="bg-gray-900 border-t border-gray-800 mt-12 py-12">
                <div className="max-w-7xl mx-auto px-4 text-center">
                    <div className="flex justify-center items-center space-x-2 mb-4">
                         <Gamepad2 className="text-purple-500" />
                         <span className="text-xl font-bold text-white">NEXUS GAMING</span>
                    </div>
                    <p className="text-gray-500 text-sm">
                        © 2025 Nexus Gaming. All rights reserved. Built for the players.
                    </p>
                </div>
            </footer>
        </>
      )}

      {/* Game Overlay Modal */}
      {activeGame && (
        <GameModal 
            game={activeGame} 
            onClose={() => setActiveGame(null)} 
            isPremium={isPremium}
            onOpenSubscribe={() => setShowSubscribeModal(true)}
        />
      )}

      <NexusAIChat isPremium={isPremium} />
      
      <SubscriptionModal 
          isOpen={showSubscribeModal} 
          onClose={() => setShowSubscribeModal(false)} 
          onUpgrade={() => setIsPremium(true)}
      />
    </div>
  );
};

export default App;
